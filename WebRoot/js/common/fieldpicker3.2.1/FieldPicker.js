Ext.ux.FieldPicker=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){$me=this;$me.pickerWin.center().show()},initComponent:function(){if(!this.pickerWin){this.initPickerWin()}Ext.ux.FieldPicker.superclass.initComponent.call(this)},_tp:null,_vp:null,dataObj:null,editable:false,enableMultiSelect:false,dataUrl:null,pickerWin:null,selectItem:null,winTitle:"",itemcheckCls:"field-picker-itemcheck",itemuncheckCls:"field-picker-itemuncheck",initPickerWin:function(){var b=this;var a=null;this._tp=new Ext.XTemplate('<div class="field-picker-indexdiv">','<tpl for=".">','<a class="field-picker-indexa"  href="javascript:void(0)" onclick="pickrScroll(\'{title}\',\''+b.id+"')\">{title}</a>","</tpl>","</div>",'<div id="'+b.id+'_picker-table-div" style="overflow-y: auto; height: 292px; overflow-x: hidden; padding: 0px 10px;">','<table class="field-picker-table" cellpadding="0" width="100%">','<tpl for=".">','<tpl if="values.items[0].items">','<tpl for="items">','<tr class="{[xindex===xcount?"field-pick-splitlasttr":""]} {[xindex===1?"field-pick-splitfirsttr":""]}">','<td rowspan="{xcount}" valign="top" class="field-picker-title" width="17px" align="center" id="{[xindex===1?"'+b.id+'"+\'_\'+parent.title:""]}">{[xindex===1?parent.title:"&nbsp;"]}</td>','<td width="44px" align="center" valign="top"><a class="field-picker-smalltitle '+b.itemuncheckCls+'" href="javascript:void(0)" id="'+b.id+'_{value}" onclick="viewItemClick(this,\'{name}\')" >{name}</a></td>',"<td>",'<tpl for="items">','<a class="field-picker-item '+b.itemuncheckCls+'" href="javascript:void(0)" id="'+b.id+'_{value}" onclick="viewItemClick(this,\'{name}\')">{name}</a>',"</tpl>","&nbsp;","</td></tr>","</tpl>","</tpl>",'<tpl if="!values.items[0].items">','<tr class="field-pick-splitlasttr field-pick-splitfirsttr"><td  valign="top" class="field-picker-title" width="17px" align="center" id="'+b.id+'_{title}">{title}</td><td>','<tpl for="items">','<a class="field-picker-item '+b.itemuncheckCls+'" href="javascript:void(0)" id="'+b.id+'_{value}" onclick="viewItemClick(this,\'{name}\')">{name}</a>',"</tpl>","&nbsp;","</td></tr>","</tpl>","</tpl>","</table></div>");Ext.Ajax.request({url:b.dataUrl,async:false,success:function(c){a=Ext.decode(c.responseText);b._vp=new Ext.Panel({data:a,width:394,bodyStyle:"border:1px solid #BBBBBB",height:326,overflowX:"hidden",tpl:b._tp});b.pickerWin=new Ext.Window({title:'<font class="x-window-header-text-default">'+b.winTitle+"</font>",items:b._vp,modal:true,buttonAlign:"center",overflowX:"hidden",minWidth:420,minHeight:437,layout:"fit",bodyStyle:"padding:20px 5px;",closeAction:"hide",renderTo:Ext.getBody(),buttons:b.initButton()})}})},getValue:function(){return this.subValue.join(",")},subValue:[],showValue:[],setValue:function(e){var c=this,f=c.el;if(f&&c.emptyText&&!Ext.isEmpty(e)){f.removeCls(c.emptyCls);c.valueContainsPlaceholder=false}if(!Ext.isEmpty(e)){var b=e.split(",");for(var a=0;a<b.length;a++){var d=c.id+"_"+b[a];if(Ext.getDom(d)){Ext.getDom(d).onclick()}}if(this.enableMultiSelect){c.setDomValue(c.showValue.join(","))}}c.applyEmptyText();return c},initButton:function(){var a=this;if(!this.enableMultiSelect){return null}return[{text:"确定",handler:function(){a.setDomValue(a.showValue.join(","));a.pickerWin.hide()}},{text:"取消",handler:function(){a.pickerWin.hide()}}]},setDomValue:function(b){var a=this;if(a.el){a.el.dom.value=b}}});function viewItemClick(e,a){e=Ext.isString(e)?Ext.getDom(e):e;var f=e.id.split("_");var g=Ext.getCmp(f[0]);var d=f[1];if(g.enableMultiSelect){var c=false;for(var b=0;b<g.subValue.length;b++){if(g.subValue[b]===d){c=true}}if(!c){Ext.fly(e).replaceClass(g.itemuncheckCls,g.itemcheckCls);g.subValue.push(d);g.showValue.push(a)}else{Ext.fly(e).replaceClass(g.itemcheckCls,g.itemuncheckCls);g.subValue.remove(d);g.showValue.remove(a)}}else{if(g.getValue()!==a){Ext.fly(e).replaceClass(g.itemuncheckCls,g.itemcheckCls);if(g.selectItem){Ext.fly(g.selectItem).replaceClass(g.itemcheckCls,g.itemuncheckCls)}}g.pickerWin.hide();g.setDomValue(a);g.subValue=[];g.subValue.push(d);g.selectItem=e}}function pickrScroll(c,a){var b=Ext.get(a+"_picker-table-div");b.scrollTo("top",Ext.get(a+"_"+c).getOffsetsTo(b)[1],true)}Ext.reg("fieldpicker",Ext.ux.FieldPicker);